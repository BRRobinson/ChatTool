<div class="chat-window" *ngIf="selectedChat; else noUser">
  <h3>Chat: {{ selectedChat.title }}</h3>

  <div class="messages">
    <div *ngFor="let msg of messages" 
        [class.own]="msg.sender.username === activeUser!.username"
        [class.other]="msg.sender.username !== activeUser!.username">
      <div class="bubble" (click)="selectMessage(msg)">
        <strong>{{ msg.sender.username }}:</strong>
        <div 
          class="bubble-buttons"
          *ngIf="selectedMessage === msg; else displayMessage">
          <input [(ngModel)]="editContent" class="edit-input" />
          <button (click)="saveMessage(msg); $event.stopPropagation()">Save</button>
          <button (click)="deleteMessage(msg); $event.stopPropagation()">Delete</button>
        </div>

        <!-- Normal display if not selected -->
        <ng-template #displayMessage>
          <p>{{ msg.content }}</p>
          <small class="timestamp">{{ msg.sentAt | date:'shortTime' }}</small>
        </ng-template>
      </div>
    </div>
  </div>

  <div class="input-area">
    <input [(ngModel)]="newMessage" placeholder="Type a message..." />
    <button (click)="sendMessage()">Send</button>
  </div>
</div>

<ng-template #noUser>
  <p>Select a user to start chatting.</p>
</ng-template>